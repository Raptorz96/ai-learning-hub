<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Multi-Tool Biblioteca con Google Sheets e Make.com - AI Learning Hub</title>
    <style>
        :root {
            --primary: #6366f1;
            --secondary: #ec4899;
            --accent: #06b6d4;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --dark: #0f172a;
            --light: #f8fafc;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--dark);
            color: #e2e8f0;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Background Animation */
        .library-bg {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: -1;
            overflow: hidden;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, rgba(236, 72, 153, 0.05) 100%);
        }

        .library-element {
            position: absolute;
            font-size: 2rem;
            opacity: 0.1;
            animation: float 20s infinite ease-in-out;
        }

        .book1 { top: 10%; left: 10%; animation-delay: 0s; }
        .book2 { top: 20%; right: 20%; animation-delay: 3s; }
        .book3 { bottom: 30%; left: 15%; animation-delay: 6s; }
        .book4 { bottom: 10%; right: 10%; animation-delay: 9s; }
        .book5 { top: 50%; left: 50%; animation-delay: 12s; }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-20px) rotate(5deg); }
            75% { transform: translateY(20px) rotate(-5deg); }
        }

        /* Header */
        header {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            border-bottom: 1px solid rgba(99, 102, 241, 0.2);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: transform 0.3s;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
            align-items: center;
        }

        .nav-links a {
            color: #cbd5e1;
            text-decoration: none;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: var(--primary);
        }

        /* Main Content */
        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Guide Header */
        .guide-header {
            text-align: center;
            margin-bottom: 4rem;
            animation: fadeInDown 0.8s ease-out;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .guide-badge {
            display: inline-block;
            background: var(--gradient);
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 20px;
            font-weight: 600;
            margin-bottom: 1rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .guide-header h1 {
            font-size: 3rem;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
        }

        .guide-subtitle {
            font-size: 1.2rem;
            color: #94a3b8;
            max-width: 800px;
            margin: 0 auto;
        }

        /* Table of Contents */
        .toc {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 3rem;
            backdrop-filter: blur(10px);
        }

        .toc h2 {
            color: var(--primary);
            margin-bottom: 1.5rem;
        }

        .toc-list {
            list-style: none;
        }

        .toc-list li {
            margin-bottom: 0.75rem;
            padding-left: 1.5rem;
            position: relative;
        }

        .toc-list li::before {
            content: "→";
            position: absolute;
            left: 0;
            color: var(--accent);
        }

        .toc-list a {
            color: #cbd5e1;
            text-decoration: none;
            transition: all 0.3s;
        }

        .toc-list a:hover {
            color: var(--primary);
            padding-left: 5px;
        }

        /* Content Sections */
        .content-section {
            margin-bottom: 4rem;
            animation: fadeInUp 0.8s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
            color: var(--primary);
            font-size: 2rem;
        }

        .section-icon {
            background: rgba(99, 102, 241, 0.2);
            padding: 1rem;
            border-radius: 15px;
            font-size: 1.5rem;
        }

        /* Architecture Diagram */
        .architecture-diagram {
            background: rgba(30, 41, 59, 0.3);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            font-family: monospace;
            font-size: 0.9rem;
            line-height: 1.8;
            overflow-x: auto;
        }

        /* Step Cards */
        .step-card {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }

        .step-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(99, 102, 241, 0.1);
        }

        .step-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .step-number {
            background: var(--gradient);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .step-title {
            font-size: 1.5rem;
            color: var(--primary);
        }

        /* Code Example */
        .code-example {
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 15px;
            margin: 2rem 0;
            overflow: hidden;
            position: relative;
        }

        .code-header {
            background: rgba(99, 102, 241, 0.1);
            padding: 1rem 1.5rem;
            border-bottom: 1px solid rgba(99, 102, 241, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .code-lang {
            color: var(--primary);
            font-weight: 600;
        }

        .copy-btn {
            background: rgba(99, 102, 241, 0.2);
            border: 1px solid rgba(99, 102, 241, 0.3);
            color: var(--primary);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .copy-btn:hover {
            background: rgba(99, 102, 241, 0.3);
            transform: translateY(-2px);
        }

        pre {
            padding: 1.5rem;
            color: #e2e8f0;
            overflow-x: auto;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        /* Alert Boxes */
        .alert {
            padding: 1.5rem;
            border-radius: 15px;
            margin: 2rem 0;
            border: 1px solid;
            position: relative;
            overflow: hidden;
        }

        .alert::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: currentColor;
        }

        .alert-info {
            background: rgba(6, 182, 212, 0.1);
            border-color: rgba(6, 182, 212, 0.3);
            color: var(--accent);
        }

        .alert-warning {
            background: rgba(245, 158, 11, 0.1);
            border-color: rgba(245, 158, 11, 0.3);
            color: var(--warning);
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            border-color: rgba(16, 185, 129, 0.3);
            color: var(--success);
        }

        /* Feature Grid */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .feature-card {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(99, 102, 241, 0.2);
            border-radius: 15px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            border-color: rgba(99, 102, 241, 0.5);
        }

        .feature-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .guide-header h1 {
                font-size: 2.5rem;
            }
            
            .nav-links {
                gap: 1rem;
                font-size: 0.9rem;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
            }

            .architecture-diagram {
                font-size: 0.8rem;
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Library Animation Background -->
    <div class="library-bg">
        <div class="library-element book1">📚</div>
        <div class="library-element book2">📖</div>
        <div class="library-element book3">📕</div>
        <div class="library-element book4">📗</div>
        <div class="library-element book5">📘</div>
    </div>

    <!-- Header -->
    <header>
        <nav>
            <a href="../index.html" class="logo">
                <span>🧠</span> AI Learning Hub
            </a>
            <ul class="nav-links">
                <li><a href="../lezioni.html">Lezioni</a></li>
                <li><a href="../guide.html">Guide</a></li>
                <li><a href="../index.html">Home</a></li>
            </ul>
        </nav>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Guide Header -->
        <div class="guide-header">
            <div class="guide-badge">
                📚 Sistema Multi-Tool con Google Sheets
            </div>
            <h1>Sistema Biblioteca Digitale con Google Sheets</h1>
            <p class="guide-subtitle">
                Implementa la sfida della Lezione 3: costruisci un sistema completo di gestione biblioteca 
                con 4 tools interconnessi, usando Google Sheets come database e Make.com per l'orchestrazione
            </p>
        </div>

        <!-- Table of Contents -->
        <div class="toc">
            <h2>📑 Indice della Guida</h2>
            <ul class="toc-list">
                <li><a href="#overview">Overview: Cosa costruiremo</a></li>
                <li><a href="#architettura">Architettura del sistema</a></li>
                <li><a href="#setup-sheets">Setup Database con Google Sheets</a></li>
                <li><a href="#tool-ricerca">Tool 1: Ricerca Libri</a></li>
                <li><a href="#tool-prestiti">Tool 2: Gestione Prestiti</a></li>
                <li><a href="#tool-raccomandazioni">Tool 3: Sistema Raccomandazioni</a></li>
                <li><a href="#tool-notifiche">Tool 4: Notifiche Email</a></li>
                <li><a href="#orchestrazione">Orchestrazione con OpenAI</a></li>
                <li><a href="#testing">Testing completo del sistema</a></li>
                <li><a href="#ottimizzazioni">Ottimizzazioni e costi</a></li>
            </ul>
        </div>

        <!-- Section 1: Overview -->
        <div class="content-section" id="overview">
            <h2 class="section-title">
                <div class="section-icon">🎯</div>
                Overview: Cosa Costruiremo
            </h2>

            <p style="font-size: 1.1rem; margin-bottom: 2rem;">
                In questa guida implementeremo un sistema bibliotecario completo che gestisce prestiti, 
                ricerche, raccomandazioni e notifiche. Un unico agente AI orchestrerà 4 tools specializzati 
                per offrire un'esperienza conversazionale naturale.
            </p>

            <div class="feature-grid">
                <div class="feature-card">
                    <div class="feature-icon">🔍</div>
                    <h3>Ricerca Intelligente</h3>
                    <p>Cerca libri per titolo, autore o genere nel catalogo</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">📋</div>
                    <h3>Gestione Prestiti</h3>
                    <p>Prenota libri, gestisci restituzioni e verifica disponibilità</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">🎯</div>
                    <h3>Raccomandazioni AI</h3>
                    <p>Suggerimenti personalizzati basati sulla storia utente</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">📧</div>
                    <h3>Notifiche Automatiche</h3>
                    <p>Email di conferma prestito e promemoria scadenze</p>
                </div>
            </div>

            <div class="alert alert-info">
                <h3>💡 Cosa imparerai</h3>
                <ul style="margin-top: 1rem; padding-left: 1.5rem;">
                    <li>Come usare Google Sheets come database per i tuoi agenti</li>
                    <li>Come creare tools complessi che interagiscono tra loro</li>
                    <li>Come gestire lo stato in conversazioni multi-step</li>
                    <li>Come implementare logica condizionale in Make.com</li>
                    <li>Come ottimizzare costi e performance</li>
                </ul>
            </div>
        </div>

        <!-- Section 2: Architecture -->
        <div class="content-section" id="architettura">
            <h2 class="section-title">
                <div class="section-icon">🏗️</div>
                Architettura Visuale del Sistema
            </h2>

            <div class="architecture-diagram">
[Webhook Input] → [Router Comandi]
├─ "cerca libro" → [Google Sheets Search] → [Format Results]
├─ "prenota" → [Check Availability] → [Add Row] → [Send Email]
├─ "consiglia" → [Get User History] → [OpenAI Recommend] → [Format List]
└─ "restituisci" → [Find Loan] → [Update Status] → [Confirmation]
            </div>

            <p style="margin: 2rem 0;">
                Il sistema utilizza un router centrale che identifica l'intento dell'utente e attiva 
                il workflow appropriato. Ogni workflow è ottimizzato per il suo scopo specifico.
            </p>

            <div class="alert alert-warning">
                <h3>⚠️ Prerequisiti</h3>
                <ul style="margin-top: 1rem; padding-left: 1.5rem;">
                    <li>Account Google (per Google Sheets - gratis)</li>
                    <li>Account Make.com (piano free è sufficiente per iniziare)</li>
                    <li>Account email per invio notifiche (Gmail va benissimo)</li>
                    <li>API key OpenAI per il sistema di raccomandazioni (opzionale)</li>
                </ul>
            </div>
        </div>

        <!-- Section 3: Setup Google Sheets -->
        <div class="content-section" id="setup-sheets">
            <h2 class="section-title">
                <div class="section-icon">📊</div>
                Setup Database con Google Sheets
            </h2>

            <div class="step-card">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <h3 class="step-title">Crea il Google Sheet</h3>
                </div>
                
                <p>Vai su <a href="https://sheets.google.com" target="_blank" style="color: var(--accent);">sheets.google.com</a> 
                   e crea un nuovo foglio di calcolo.</p>
                
                <ol style="padding-left: 1.5rem; margin-top: 1rem;">
                    <li>Clicca sul <strong>+ Vuoto</strong> per creare un nuovo foglio</li>
                    <li>Rinomina il file in <strong>"Biblioteca Digitale"</strong> (clicca su "Foglio di lavoro senza titolo")</li>
                    <li>Crea 3 fogli usando i tab in basso:
                        <ul style="margin-top: 0.5rem;">
                            <li>Rinomina "Foglio1" → <strong>"Libri"</strong></li>
                            <li>Aggiungi nuovo foglio → <strong>"Utenti"</strong></li>
                            <li>Aggiungi nuovo foglio → <strong>"Prestiti"</strong></li>
                        </ul>
                    </li>
                </ol>

                <div class="alert alert-info" style="margin-top: 1rem;">
                    <strong>💡 Tip:</strong> Per aggiungere un nuovo foglio, clicca sul <strong>+</strong> in basso a sinistra
                </div>
            </div>

            <div class="step-card">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <h3 class="step-title">Configura il Foglio "Libri"</h3>
                </div>
                
                <p>Nel foglio <strong>"Libri"</strong>, crea questi header nella prima riga (A1:G1):</p>
                
                <div class="code-example">
                    <div class="code-header">
                        <span class="code-lang">Headers Foglio Libri</span>
                        <button class="copy-btn" onclick="copyCode(this)">📋 Copia</button>
                    </div>
                    <pre><code>ID | Titolo | Autore | ISBN | Genere | Disponibile | Copie_Totali | Copie_Disponibili</code></pre>
                </div>

                <p style="margin-top: 1rem;">Ora aggiungi alcuni libri di esempio (copia e incolla dalla riga 2):</p>
                
                <div class="code-example">
                    <div class="code-header">
                        <span class="code-lang">Dati Esempio</span>
                        <button class="copy-btn" onclick="copyCode(this)">📋 Copia</button>
                    </div>
                    <pre><code>1	Il nome della rosa	Umberto Eco	978-8845292613	Fiction	SI	3	2
2	1984	George Orwell	978-0452284234	Fiction	SI	2	1
3	Sapiens	Yuval Noah Harari	978-0062316097	Non-fiction	SI	4	3
4	Il signore degli anelli	J.R.R. Tolkien	978-8845292620	Fantasy	NO	2	0
5	Neuromante	William Gibson	978-0441007462	Sci-Fi	SI	1	1</code></pre>
                </div>
            </div>

            <div class="step-card">
                <div class="step-header">
                    <div class="step-number">3</div>
                    <h3 class="step-title">Configura il Foglio "Utenti"</h3>
                </div>
                
                <p>Nel foglio <strong>"Utenti"</strong>, crea questi header:</p>
                
                <div class="code-example">
                    <div class="code-header">
                        <span class="code-lang">Headers Foglio Utenti</span>
                        <button class="copy-btn" onclick="copyCode(this)">📋 Copia</button>
                    </div>
                    <pre><code>ID | Nome | Email | Data_Iscrizione | Generi_Preferiti</code></pre>
                </div>

                <p style="margin-top: 1rem;">Aggiungi alcuni utenti di esempio:</p>
                
                <div class="code-example">
                    <div class="code-header">
                        <span class="code-lang">Dati Esempio</span>
                        <button class="copy-btn" onclick="copyCode(this)">📋 Copia</button>
                    </div>
                    <pre><code>1	Mario Rossi	mario.rossi@email.com	01/01/2024	Fiction, Fantasy
2	Laura Bianchi	laura.bianchi@email.com	15/01/2024	Non-fiction, Sci-Fi
3	Giuseppe Verdi	giuseppe.verdi@email.com	20/01/2024	Fiction, Non-fiction</code></pre>
                </div>
            </div>

            <div class="step-card">
                <div class="step-header">
                    <div class="step-number">4</div>
                    <h3 class="step-title">Configura il Foglio "Prestiti"</h3>
                </div>
                
                <p>Nel foglio <strong>"Prestiti"</strong>, crea questi header:</p>
                
                <div class="code-example">
                    <div class="code-header">
                        <span class="code-lang">Headers Foglio Prestiti</span>
                        <button class="copy-btn" onclick="copyCode(this)">📋 Copia</button>
                    </div>
                    <pre><code>ID | ID_Libro | ID_Utente | Data_Prestito | Data_Restituzione_Prevista | Data_Restituzione_Effettiva | Stato</code></pre>
                </div>
            </div>

            <div class="step-card">
                <div class="step-header">
                    <div class="step-number">5</div>
                    <h3 class="step-title">Condividi il Foglio per Make.com</h3>
                </div>
                
                <ol style="padding-left: 1.5rem;">
                    <li>Clicca sul pulsante <strong>"Condividi"</strong> in alto a destra</li>
                    <li>Sotto "Accesso generale", clicca su <strong>"Con limitazioni"</strong></li>
                    <li>Cambialo in <strong>"Chiunque abbia il link"</strong> con permesso <strong>"Editor"</strong></li>
                    <li>Copia il link (ti servirà per Make.com)</li>
                </ol>

                <div class="alert alert-success" style="margin-top: 1rem;">
                    <strong>✅ Fatto!</strong> Il tuo database è pronto. Google Sheets è molto più semplice di Airtable 
                    e si integra perfettamente con Make.com!
                </div>
            </div>
        </div>

        <!-- Section 4: Tool 1 - Search -->
        <div class="content-section" id="tool-ricerca">
            <h2 class="section-title">
                <div class="section-icon">🔍</div>
                Tool 1: Ricerca Libri
            </h2>

            <div class="step-card">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <h3 class="step-title">Crea lo Scenario in Make.com</h3>
                </div>
                
                <ol style="padding-left: 1.5rem;">
                    <li>Accedi a Make.com e crea un nuovo scenario</li>
                    <li>Rinominalo "Biblioteca - Ricerca Libri"</li>
                    <li>Aggiungi un webhook come trigger</li>
                </ol>
            </div>

            <div class="step-card">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <h3 class="step-title">Configura il Webhook</h3>
                </div>
                
                <p>Clicca sul webhook e configura:</p>
                <ul style="padding-left: 1.5rem; margin-top: 1rem;">
                    <li>Nome: "Ricerca Libri Trigger"</li>
                    <li>Copia l'URL del webhook (ti servirà dopo)</li>
                </ul>

                <p style="margin-top: 1rem;">Determina la struttura dati inviando questo JSON di test:</p>
                
                <div class="code-example">
                    <div class="code-header">
                        <span class="code-lang">JSON</span>
                        <button class="copy-btn" onclick="copyCode(this)">📋 Copia</button>
                    </div>
                    <pre><code>{
  "action": "search",
  "query": "Umberto Eco"
}</code></pre>
                </div>
            </div>

            <div class="step-card">
                <div class="step-header">
                    <div class="step-number">3</div>
                    <h3 class="step-title">Connetti Google Sheets</h3>
                </div>
                
                <ol style="padding-left: 1.5rem;">
                    <li>Aggiungi un nuovo modulo → Google Sheets → "Search Rows"</li>
                    <li>Crea una nuova connessione:
                        <ul style="margin-top: 0.5rem;">
                            <li>Clicca "Add" → Autorizza l'accesso al tuo Google Account</li>
                            <li>Dai un nome alla connessione (es. "Il mio Google")</li>
                        </ul>
                    </li>
                    <li>Configura il modulo:
                        <ul style="margin-top: 0.5rem;">
                            <li><strong>Spreadsheet:</strong> Seleziona "Biblioteca Digitale"</li>
                            <li><strong>Sheet:</strong> Libri</li>
                            <li><strong>Filter:</strong> Contains text</li>
                            <li><strong>Column range:</strong> A:H (tutte le colonne)</li>
                            <li><strong>Value:</strong> {{1.query}} (dal webhook)</li>
                        </ul>
                    </li>
                </ol>

                <div class="alert alert-info" style="margin-top: 1rem;">
                    <strong>💡 Tip:</strong> Google Sheets cerca in tutte le colonne specificate, quindi troverà 
                    corrispondenze sia nel titolo che nell'autore!
                </div>
            </div>

            <div class="step-card">
                <div class="step-header">
                    <div class="step-number">4</div>
                    <h3 class="step-title">Formatta i Risultati</h3>
                </div>
                
                <p>Aggiungi un modulo "Tools → Text Aggregator" per unire tutti i risultati:</p>
                
                <ol style="padding-left: 1.5rem; margin-top: 1rem;">
                    <li><strong>Source Module:</strong> Google Sheets - Search Rows</li>
                    <li><strong>Text:</strong></li>
                </ol>
                
                <div class="code-example">
                    <div class="code-header">
                        <span class="code-lang">Template</span>
                        <button class="copy-btn" onclick="copyCode(this)">📋 Copia</button>
                    </div>
                    <pre><code>📚 **{{2.B}}** di {{2.C}}
📖 Genere: {{2.E}}
✅ Disponibilità: {{if(2.F = "SI"; "Disponibile"; "Non disponibile")}}
📊 Copie: {{2.H}}/{{2.G}}
---</code></pre>
                </div>

                <p style="margin-top: 1rem;"><strong>Nota:</strong> Le lettere (B, C, E, etc.) corrispondono alle colonne del foglio</p>
            </div>

            <div class="step-card">
                <div class="step-header">
                    <div class="step-number">5</div>
                    <h3 class="step-title">Webhook Response</h3>
                </div>
                
                <p>Aggiungi "Webhooks → Webhook response" alla fine:</p>
                <ul style="padding-left: 1.5rem; margin-top: 1rem;">
                    <li>Status: 200</li>
                    <li>Body: 
                        <div class="code-example" style="margin-top: 0.5rem;">
                            <div class="code-header">
                                <span class="code-lang">JSON</span>
                            </div>
                            <pre><code>{
  "results": "{{3.text}}",
  "count": "{{3.count}}"
}</code></pre>
                        </div>
                    </li>
                    <li>Headers: Content-Type = application/json</li>
                </ul>
            </div>
        </div>

        <!-- Section 5: Tool 2 - Loans -->
        <div class="content-section" id="tool-prestiti">
            <h2 class="section-title">
                <div class="section-icon">📋</div>
                Tool 2: Gestione Prestiti
            </h2>

            <div class="step-card">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <h3 class="step-title">Crea Scenario Prestiti</h3>
                </div>
                
                <p>Questo scenario gestirà sia i prestiti che le restituzioni con un router:</p>
                
                <div class="architecture-diagram">
[Webhook] → [Router]
├─ Route 1: action = "borrow" → [Search Book + Check Available] → [Add Row Prestiti] → [Update Book]
└─ Route 2: action = "return" → [Find Active Loan] → [Update Prestito] → [Update Book]
                </div>
            </div>

            <div class="step-card">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <h3 class="step-title">Configura il Router</h3>
                </div>
                
                <p>Dopo il webhook, dobbiamo dividere il flusso in base all'azione richiesta:</p>
                
                <ol style="padding-left: 1.5rem; margin-top: 1rem;">
                    <li>Clicca sul <strong>+</strong> dopo il webhook</li>
                    <li>Cerca e seleziona <strong>"Flow control → Router"</strong></li>
                    <li>Il router creerà automaticamente 2 percorsi (route)</li>
                </ol>

                <div style="margin-top: 2rem;">
                    <h4 style="color: var(--primary);">📘 Route 1: Prestito Libro</h4>
                    
                    <p><strong>Passo 1 - Imposta il filtro:</strong></p>
                    <ul style="padding-left: 1.5rem;">
                        <li>Clicca su "Set up a filter" tra Router e Route 1</li>
                        <li>Nome filtro: "È un prestito"</li>
                        <li>Condizione: <code>{{1.action}}</code> Equal to (=) <code>borrow</code></li>
                    </ul>

                    <p style="margin-top: 1rem;"><strong>Passo 2 - Cerca il libro e verifica disponibilità (Modulo 1 di Route 1):</strong></p>
                    <ul style="padding-left: 1.5rem;">
                        <li>Aggiungi: <strong>Google Sheets → Search Rows</strong></li>
                        <li>Spreadsheet: Biblioteca Digitale</li>
                        <li>Sheet: Libri</li>
                        <li>Has header row: Yes</li>
                        <li>Column range: A-H</li>
                        <li><strong>Filter</strong> (configura 2 condizioni con AND):
                            <ul style="margin-top: 0.5rem;">
                                <li><strong>ISBN (D)</strong> → Text operators: Equal to → <code>{{1.isbn}}</code></li>
                                <li>Clicca <strong>"Add AND rule"</strong></li>
                                <li><strong>Copie_Disponibili (H)</strong> → Numeric operators: Greater than → <code>0</code></li>
                            </ul>
                        </li>
                    </ul>

                    <div class="alert alert-success" style="margin-top: 1rem;">
                        <strong>✅ Molto meglio!</strong> Con i filtri AND di Google Sheets, verifichiamo 
                        in un solo passaggio che il libro esista E sia disponibile. Se non trova risultati, 
                        il libro non è disponibile!
                    </div>

                    <p style="margin-top: 1rem;"><strong>Passo 3 - Registra il prestito (Modulo 2):</strong></p>
                    <ul style="padding-left: 1.5rem;">
                        <li>Aggiungi: <strong>Google Sheets → Add a Row</strong></li>
                        <li>Sheet: Prestiti</li>
                        <li>Values (in ordine delle colonne):
                            <div class="code-example" style="margin-top: 0.5rem;">
                                <pre><code>A (ID): {{increment()}}
B (ID_Libro): {{2.A}}
C (ID_Utente): {{1.user_id}}
D (Data_Prestito): {{formatDate(now; "DD/MM/YYYY")}}
E (Data_Restituzione_Prevista): {{formatDate(addDays(now; 14); "DD/MM/YYYY")}}
F (Data_Restituzione_Effettiva): [lascia vuoto]
G (Stato): Attivo</code></pre>
                            </div>
                        </li>
                    </ul>

                    <p style="margin-top: 1rem;"><strong>Passo 5 - Aggiorna copie libro (Modulo 4):</strong></p>
                    <ul style="padding-left: 1.5rem;">
                        <li>Aggiungi: <strong>Google Sheets → Update a Row</strong></li>
                        <li>Sheet: Libri</li>
                        <li>Row number: <code>{{2.rowNumber}}</code></li>
                        <li>Values da aggiornare:
                            <ul style="margin-top: 0.5rem;">
                                <li>Column F (Disponibile): <code>{{if(2.H - 1 > 0; "SI"; "NO")}}</code></li>
                                <li>Column H (Copie_Disponibili): <code>{{2.H - 1}}</code></li>
                            </ul>
                        </li>
                    </ul>
                </div>

                <div style="margin-top: 2rem;">
                    <h4 style="color: var(--primary);">📙 Route 2: Restituzione Libro</h4>
                    
                    <p><strong>Passo 1 - Imposta il filtro:</strong></p>
                    <ul style="padding-left: 1.5rem;">
                        <li>Clicca su "Set up a filter" tra Router e Route 2</li>
                        <li>Nome filtro: "È una restituzione"</li>
                        <li>Condizione: <code>{{1.action}}</code> Equal to (=) <code>return</code></li>
                    </ul>

                    <p style="margin-top: 1rem;"><strong>Passo 2 - Trova il prestito attivo (Modulo 1 di Route 2):</strong></p>
                    <ul style="padding-left: 1.5rem;">
                        <li>Aggiungi: <strong>Google Sheets → Search Rows</strong></li>
                        <li>Sheet: Prestiti</li>
                        <li>Has header row: Yes</li>
                        <li>Column range: A-G</li>
                        <li><strong>Filter</strong> (configura 2 condizioni con AND):
                            <ul style="margin-top: 0.5rem;">
                                <li><strong>ID_Libro (B)</strong> → Text operators: Equal to → <code>{{1.id_libro}}</code></li>
                                <li>Clicca <strong>"Add AND rule"</strong></li>
                                <li><strong>Stato (G)</strong> → Text operators: Equal to → <code>Attivo</code></li>
                            </ul>
                        </li>
                    </ul>

                    <p style="margin-top: 1rem;"><strong>Passo 3 - Aggiorna il prestito (Modulo 2):</strong></p>
                    <ul style="padding-left: 1.5rem;">
                        <li>Aggiungi: <strong>Google Sheets → Update a Row</strong></li>
                        <li>Sheet: Prestiti</li>
                        <li>Row number: <code>{{5.rowNumber}}</code> (dal modulo precedente)</li>
                        <li>Values:
                            <ul style="margin-top: 0.5rem;">
                                <li>Column F: <code>{{formatDate(now; "DD/MM/YYYY")}}</code></li>
                                <li>Column G: "Restituito"</li>
                            </ul>
                        </li>
                    </ul>

                    <p style="margin-top: 1rem;"><strong>Passo 4 - Ripristina copie libro (Modulo 3):</strong></p>
                    <ul style="padding-left: 1.5rem;">
                        <li>Prima devi cercare il libro per ottenere le copie attuali</li>
                        <li>Aggiungi: <strong>Google Sheets → Get a Row</strong></li>
                        <li>Sheet: Libri</li>
                        <li>Row number: <code>{{5.B}}</code> (ID del libro dal prestito)</li>
                        <li>Poi aggiungi: <strong>Google Sheets → Update a Row</strong></li>
                        <li>Aggiorna Copie_Disponibili: <code>{{7.H + 1}}</code></li>
                        <li>Aggiorna Disponibile: "SI"</li>
                    </ul>
                </div>

                <div class="alert alert-info" style="margin-top: 2rem;">
                    <strong>💡 Come funzionano i numeri nei moduli:</strong>
                    <ul style="margin-top: 0.5rem; padding-left: 1.5rem;">
                        <li><code>{{1.campo}}</code> = dati dal webhook iniziale</li>
                        <li><code>{{2.campo}}</code> = dati dal primo modulo Google Sheets</li>
                        <li><code>{{5.campo}}</code> = dati dal quinto modulo (numerazione progressiva)</li>
                        <li>Le lettere (A, B, C...) sono le colonne del foglio Google</li>
                    </ul>
                    <p style="margin-top: 0.5rem;"><strong>Nota:</strong> I numeri cambiano in base a quanti moduli hai nel tuo scenario!</p>
                </div>
            </div>

            <div class="step-card">
                <div class="step-header">
                    <div class="step-number">3</div>
                    <h3 class="step-title">JSON di Test</h3>
                </div>
                
                <p>Testa il prestito con:</p>
                <div class="code-example">
                    <div class="code-header">
                        <span class="code-lang">JSON</span>
                        <button class="copy-btn" onclick="copyCode(this)">📋 Copia</button>
                    </div>
                    <pre><code>{
  "action": "borrow",
  "isbn": "978-8845292613",
  "user_id": "1",
  "user_email": "mario.rossi@email.com"
}</code></pre>
                </div>

                <div class="alert alert-info" style="margin-top: 1rem;">
                    <strong>💡 Tip:</strong> Con Google Sheets è più facile! Non serve creare record linkati 
                    complessi, usiamo semplici ID numerici.
                </div>
            </div>
        </div>

        <!-- Section 6: Tool 3 - Recommendations -->
        <div class="content-section" id="tool-raccomandazioni">
            <h2 class="section-title">
                <div class="section-icon">🎯</div>
                Tool 3: Sistema Raccomandazioni
            </h2>

            <div class="step-card">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <h3 class="step-title">Logica delle Raccomandazioni</h3>
                </div>
                
                <p>Il sistema analizza la storia dell'utente e usa GPT per generare suggerimenti:</p>
                
                <ol style="padding-left: 1.5rem; margin-top: 1rem;">
                    <li>Recupera tutti i prestiti passati dell'utente</li>
                    <li>Identifica i generi più letti</li>
                    <li>Trova libri disponibili di generi simili</li>
                    <li>Usa OpenAI per generare raccomandazioni personalizzate</li>
                </ol>
            </div>

            <div class="step-card">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <h3 class="step-title">Implementazione in Make</h3>
                </div>
                
                <div class="architecture-diagram">
[Webhook] → [Get User Loans] → [Extract Book IDs] → [Get Books Info] 
    ↓
[Find Available Books] → [OpenAI Generate] → [Format Response]
                </div>

                <p style="margin-top: 1rem;"><strong>Moduli da configurare:</strong></p>
                
                <ol style="padding-left: 1.5rem;">
                    <li><strong>Google Sheets - Search Rows:</strong>
                        <ul>
                            <li>Sheet: Prestiti</li>
                            <li>Filter: Column C (ID_Utente) = {{1.user_id}}</li>
                        </ul>
                    </li>
                    
                    <li><strong>Tools - Set Multiple Variables:</strong>
                        <ul>
                            <li>Estrai lista di ID_Libro dai prestiti</li>
                            <li>Conta frequenza generi</li>
                        </ul>
                    </li>
                    
                    <li><strong>Google Sheets - Search Rows:</strong>
                        <ul>
                            <li>Sheet: Libri</li>
                            <li>Filter: Disponibile = "SI"</li>
                            <li>Limit: 10 risultati</li>
                        </ul>
                    </li>
                    
                    <li><strong>OpenAI - Create a Completion:</strong></li>
                </ol>
                
                <div class="code-example" style="margin-top: 1rem;">
                    <div class="code-header">
                        <span class="code-lang">Prompt</span>
                        <button class="copy-btn" onclick="copyCode(this)">📋 Copia</button>
                    </div>
                    <pre><code>L'utente ha letto questi libri:
{{3.books_history}}

Generi preferiti: {{4.top_genres}}

Libri disponibili in biblioteca:
{{5.available_books}}

Genera 3 raccomandazioni personalizzate spiegando perché 
potrebbero piacere all'utente. Usa un tono amichevole e 
includi emoji appropriate.</code></pre>
                </div>

                <div class="alert alert-success" style="margin-top: 1rem;">
                    <strong>✨ Alternativa semplice senza OpenAI:</strong> 
                    <p style="margin-top: 0.5rem;">Se non hai API OpenAI, puoi creare raccomandazioni basate solo sui generi:</p>
                    <ol style="margin-top: 0.5rem; padding-left: 1.5rem;">
                        <li>Conta i generi più letti dall'utente</li>
                        <li>Filtra i libri disponibili dello stesso genere</li>
                        <li>Restituisci i primi 3 come suggerimenti</li>
                    </ol>
                    <p style="margin-top: 0.5rem;">Usa un modulo "Tools → Basic trigger" per formattare la risposta!</p>
                </div>
            </div>
        </div>

        <!-- Section 7: Tool 4 - Notifications -->
        <div class="content-section" id="tool-notifiche">
            <h2 class="section-title">
                <div class="section-icon">📧</div>
                Tool 4: Notifiche Email
            </h2>

            <div class="step-card">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <h3 class="step-title">Setup Email</h3>
                </div>
                
                <p>Aggiungi il modulo Email → Send an Email:</p>
                
                <ol style="padding-left: 1.5rem; margin-top: 1rem;">
                    <li>Connetti il tuo account Gmail</li>
                    <li>To: <code>{{1.user_email}}</code></li>
                    <li>Subject: "Conferma prestito - {{3.B}}"</li>
                    <li>Content Type: HTML</li>
                </ol>

                <div class="code-example" style="margin-top: 1rem;">
                    <div class="code-header">
                        <span class="code-lang">HTML</span>
                        <button class="copy-btn" onclick="copyCode(this)">📋 Copia</button>
                    </div>
                    <pre><code>&lt;h2&gt;📚 Prestito Confermato!&lt;/h2&gt;
&lt;p&gt;Ciao {{1.user_name}},&lt;/p&gt;
&lt;p&gt;Hai preso in prestito:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Titolo:&lt;/strong&gt; {{3.B}}&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Autore:&lt;/strong&gt; {{3.C}}&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Data restituzione:&lt;/strong&gt; {{formatDate(addDays(now; 14); "DD/MM/YYYY")}}&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Buona lettura! 📖&lt;/p&gt;</code></pre>
                </div>

                <div class="alert alert-info" style="margin-top: 1rem;">
                    <strong>💡 Nota:</strong> {{3.B}} e {{3.C}} si riferiscono alle colonne B (Titolo) 
                    e C (Autore) del foglio Libri in Google Sheets
                </div>
            </div>
        </div>

        <!-- Section 8: Orchestration -->
        <div class="content-section" id="orchestrazione">
            <h2 class="section-title">
                <div class="section-icon">🎭</div>
                Orchestrazione Centrale con OpenAI
            </h2>

            <div class="step-card">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <h3 class="step-title">Scenario Master</h3>
                </div>
                
                <p>Crea uno scenario principale che riceve i messaggi utente e li smista:</p>
                
                <div class="architecture-diagram">
[Webhook Chat] → [OpenAI Classify Intent] → [Router]
├─ search → [HTTP Call Search Webhook]
├─ borrow → [HTTP Call Borrow Webhook]
├─ recommend → [HTTP Call Recommend Webhook]
└─ return → [HTTP Call Return Webhook]
                </div>
            </div>

            <div class="step-card">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <h3 class="step-title">Prompt di Classificazione</h3>
                </div>
                
                <div class="code-example">
                    <div class="code-header">
                        <span class="code-lang">System Prompt</span>
                        <button class="copy-btn" onclick="copyCode(this)">📋 Copia</button>
                    </div>
                    <pre><code>Sei un bibliotecario AI per la Biblioteca Digitale. 
Analizza il messaggio dell'utente e rispondi SOLO con un oggetto JSON 
che contiene l'azione da eseguire.

Azioni disponibili:
- search: l'utente vuole cercare un libro
- borrow: l'utente vuole prendere in prestito un libro (serve ISBN)
- return: l'utente vuole restituire un libro (serve ID libro)
- recommend: l'utente vuole consigli di lettura (serve ID utente)

Esempio output:
{
  "action": "search",
  "parameters": {
    "query": "Umberto Eco"
  }
}

Per prestiti:
{
  "action": "borrow",
  "parameters": {
    "isbn": "978-8845292613",
    "user_id": "1",
    "user_email": "mario.rossi@email.com"
  }
}</code></pre>
                </div>
            </div>

            <div class="step-card">
                <div class="step-header">
                    <div class="step-number">3</div>
                    <h3 class="step-title">HTTP Calls ai Tools</h3>
                </div>
                
                <p>Per ogni route, aggiungi un modulo HTTP → Make a Request:</p>
                
                <ul style="padding-left: 1.5rem; margin-top: 1rem;">
                    <li>URL: L'URL del webhook del tool specifico</li>
                    <li>Method: POST</li>
                    <li>Headers: Content-Type = application/json</li>
                    <li>Body: <code>{{3.parameters}}</code> (dal JSON di OpenAI)</li>
                </ul>
            </div>
        </div>

        <!-- Section 9: Testing -->
        <div class="content-section" id="testing">
            <h2 class="section-title">
                <div class="section-icon">🧪</div>
                Testing Completo del Sistema
            </h2>

            <div class="alert alert-info">
                <h3>📝 Scenari di Test</h3>
                <p>Testa questi casi d'uso per verificare che tutto funzioni:</p>
            </div>

            <div class="step-card">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <h3 class="step-title">Test Ricerca</h3>
                </div>
                
                <div class="code-example">
                    <div class="code-header">
                        <span class="code-lang">Test Message</span>
                        <button class="copy-btn" onclick="copyCode(this)">📋 Copia</button>
                    </div>
                    <pre><code>"Hai libri di Umberto Eco?"
"Cerca tutti i libri di fantascienza"
"Cosa c'è disponibile nel genere fantasy?"</code></pre>
                </div>
            </div>

            <div class="step-card">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <h3 class="step-title">Test Prestito Completo</h3>
                </div>
                
                <ol style="padding-left: 1.5rem;">
                    <li>"Vorrei prendere in prestito Il nome della rosa"</li>
                    <li>Verifica che il sistema:
                        <ul style="margin-top: 0.5rem;">
                            <li>✓ Controlli la disponibilità</li>
                            <li>✓ Crei il record prestito</li>
                            <li>✓ Aggiorni le copie disponibili</li>
                            <li>✓ Invii l'email di conferma</li>
                        </ul>
                    </li>
                </ol>
            </div>

            <div class="step-card">
                <div class="step-header">
                    <div class="step-number">3</div>
                    <h3 class="step-title">Test Edge Cases</h3>
                </div>
                
                <ul style="padding-left: 1.5rem;">
                    <li>Libro non disponibile: "Prendi in prestito [libro con 0 copie]"</li>
                    <li>Utente non registrato: Usa ID utente non presente nel foglio</li>
                    <li>Restituzione senza prestito: "Restituisci un libro mai preso"</li>
                    <li>Query ambigue: "Voglio qualcosa da leggere"</li>
                </ul>
            </div>
        </div>

        <!-- Section 10: Optimizations -->
        <div class="content-section" id="ottimizzazioni">
            <h2 class="section-title">
                <div class="section-icon">⚡</div>
                Ottimizzazioni e Costi
            </h2>

            <div class="feature-grid">
                <div class="feature-card">
                    <div class="feature-icon">💰</div>
                    <h3>Gestione Costi</h3>
                    <ul style="margin-top: 1rem; padding-left: 1.5rem;">
                        <li>Make.com free: 1000 ops/mese</li>
                        <li>Google Sheets: GRATIS illimitato!</li>
                        <li>Ogni interazione: ~4-8 operations</li>
                        <li>Stima: 125-250 query/mese gratis</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">🚀</div>
                    <h3>Performance</h3>
                    <ul style="margin-top: 1rem; padding-left: 1.5rem;">
                        <li>Google Sheets più veloce di Airtable</li>
                        <li>Limita righe a 500 per foglio ottimale</li>
                        <li>Usa VLOOKUP per relazioni semplici</li>
                        <li>Cache frequenti ricerche in variabili</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <div class="feature-icon">🔒</div>
                    <h3>Sicurezza</h3>
                    <ul style="margin-top: 1rem; padding-left: 1.5rem;">
                        <li>Condividi sheet solo con Make.com</li>
                        <li>Non rendere pubblico il foglio</li>
                        <li>Backup automatico di Google</li>
                        <li>Versioning integrato in Sheets</li>
                    </ul>
                </div>
            </div>

            <div class="alert alert-success" style="margin-top: 2rem;">
                <h3>💡 Pro Tips per Google Sheets</h3>
                <ul style="margin-top: 1rem; padding-left: 1.5rem;">
                    <li><strong>Formule utili</strong>: Usa COUNTIF per contare prestiti attivi per utente</li>
                    <li><strong>Data validation</strong>: Imposta dropdown per il campo Genere</li>
                    <li><strong>Conditional formatting</strong>: Colora in rosso i libri non disponibili</li>
                    <li><strong>Array formulas</strong>: Per calcoli automatici su intere colonne</li>
                </ul>
            </div>
        </div>

        <!-- Conclusion -->
        <div class="content-section">
            <div class="alert alert-success">
                <h2 style="text-align: center; margin-bottom: 1.5rem;">🎉 Complimenti!</h2>
                <p style="text-align: center; font-size: 1.1rem;">
                    Hai costruito un sistema bibliotecario completo con 4 tools interconnessi!
                    Questo è un esempio perfetto di come orchestrare tools specializzati 
                    per creare esperienze conversazionali naturali.
                </p>
                
                <h3 style="margin-top: 2rem;">🚀 Prossimi Passi</h3>
                <ul style="padding-left: 1.5rem; margin-top: 1rem;">
                    <li>Aggiungi un sistema di recensioni e rating</li>
                    <li>Implementa notifiche per nuovi arrivi</li>
                    <li>Crea una dashboard Analytics con Google Sheets</li>
                    <li>Integra con un front-end web per l'accesso pubblico</li>
                </ul>
                
                <p style="text-align: center; margin-top: 2rem;">
                    <a href="../lezioni/agenti-openai/lezione-4.html" 
                       style="display: inline-block; padding: 1rem 2rem; background: var(--gradient); 
                              color: white; text-decoration: none; border-radius: 50px; 
                              font-weight: 600; transition: all 0.3s;">
                        Continua con la Lezione 4 →
                    </a>
                </p>
            </div>
        </div>
    </main>

    <script>
        // Copy code function
        function copyCode(button) {
            const codeBlock = button.parentElement.nextElementSibling.querySelector('code');
            const text = codeBlock.innerText;
            
            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.innerText;
                button.innerText = '✅ Copiato!';
                setTimeout(() => {
                    button.innerText = originalText;
                }, 2000);
            });
        }

        // Smooth scrolling for TOC links
        document.querySelectorAll('.toc-list a').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = link.getAttribute('href').substring(1);
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });

        // Intersection Observer for animations
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '1';
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);

        // Observe all content sections
        document.querySelectorAll('.content-section').forEach(section => {
            section.style.opacity = '0';
            section.style.transform = 'translateY(30px)';
            section.style.transition = 'all 0.8s ease-out';
            observer.observe(section);
        });
    </script>
</body>
</html>