<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lezione 2: Fondamenti del Design - AI Learning Hub</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #ec4899;
            --accent: #06b6d4;
            --dark: #0f172a;
            --light: #f8fafc;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #fff;
            line-height: 1.6;
        }

        /* Header */
        header {
            padding: 1.5rem 0;
            backdrop-filter: blur(20px);
            background: rgba(15, 23, 42, 0.9);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }

        nav {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
            align-items: center;
        }

        .nav-links a {
            color: #cbd5e1;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .nav-links a:hover {
            color: var(--primary);
        }

        .back-home {
            background: rgba(99, 102, 241, 0.1);
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            border: 1px solid rgba(99, 102, 241, 0.3);
            transition: all 0.3s ease;
        }

        .back-home:hover {
            background: rgba(99, 102, 241, 0.2);
            transform: translateY(-2px);
        }

        /* Main Content */
        main {
            margin-top: 80px;
            padding: 2rem;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Lesson Header */
        .lesson-header {
            text-align: center;
            padding: 3rem 0;
            position: relative;
        }

        .lesson-meta {
            display: inline-block;
            background: rgba(99, 102, 241, 0.1);
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: var(--primary);
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        .lesson-header h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #fff 0%, #cbd5e1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .lesson-subtitle {
            font-size: 1.3rem;
            color: #94a3b8;
            max-width: 800px;
            margin: 0 auto;
        }

        /* Progress Indicator */
        .progress-container {
            margin: 3rem 0;
            padding: 2rem;
            background: rgba(30, 41, 59, 0.3);
            border-radius: 20px;
            border: 1px solid rgba(148, 163, 184, 0.1);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .progress-bar {
            height: 8px;
            background: rgba(148, 163, 184, 0.2);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient);
            width: 33.33%;
            transition: width 0.5s ease;
        }

        /* Content Sections */
        .content-section {
            margin: 3rem 0;
            background: rgba(30, 41, 59, 0.2);
            border-radius: 20px;
            padding: 2.5rem;
            border: 1px solid rgba(148, 163, 184, 0.1);
            position: relative;
            overflow: hidden;
        }

        .content-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient);
        }

        .section-title {
            font-size: 2rem;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .section-icon {
            width: 50px;
            height: 50px;
            background: var(--gradient);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        /* Component Cards */
        .components-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .component-card {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 15px;
            padding: 2rem;
            border: 1px solid rgba(148, 163, 184, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .component-card:hover {
            transform: translateY(-5px);
            border-color: rgba(99, 102, 241, 0.3);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .component-icon {
            width: 60px;
            height: 60px;
            background: var(--gradient);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
        }

        /* Interactive Diagram */
        .diagram-container {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 20px;
            padding: 3rem;
            margin: 2rem 0;
            text-align: center;
        }

        .agent-diagram {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .diagram-node {
            background: rgba(99, 102, 241, 0.1);
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-radius: 20px;
            padding: 1.5rem;
            min-width: 150px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .diagram-node:hover {
            background: rgba(99, 102, 241, 0.2);
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
        }

        .diagram-arrow {
            font-size: 2rem;
            color: var(--primary);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 0.7; }
            50% { transform: scale(1.2); opacity: 1; }
        }

        /* Code Examples */
        .code-example {
            background: #1e293b;
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            position: relative;
            border: 1px solid rgba(148, 163, 184, 0.1);
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }

        .code-lang {
            color: var(--primary);
            font-weight: 600;
        }

        .copy-btn {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            color: var(--primary);
            padding: 0.4rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            border: none;
        }

        pre {
            color: #e2e8f0;
            overflow-x: auto;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.95rem;
            line-height: 1.5;
            margin: 0;
        }

        code {
            font-family: inherit;
        }

        /* Model Comparison Table */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            background: rgba(30, 41, 59, 0.3);
            border-radius: 10px;
            overflow: hidden;
        }

        .comparison-table th {
            background: rgba(99, 102, 241, 0.1);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid rgba(99, 102, 241, 0.3);
        }

        .comparison-table td {
            padding: 1rem;
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }

        .comparison-table tr:hover {
            background: rgba(99, 102, 241, 0.05);
        }

        /* Lab Section */
        .lab-section {
            background: rgba(16, 185, 129, 0.05);
            border-radius: 20px;
            padding: 2.5rem;
            margin: 3rem 0;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .lab-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .lab-badge {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
            padding: 0.5rem 1.5rem;
            border-radius: 50px;
            font-weight: 600;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .lab-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .lab-input {
            flex: 1;
            min-width: 200px;
            padding: 0.8rem 1.2rem;
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 10px;
            color: white;
            font-size: 1rem;
        }

        .lab-button {
            padding: 0.8rem 1.5rem;
            background: var(--gradient);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .lab-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.3);
        }

        .lab-output {
            background: #1e293b;
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            min-height: 150px;
            font-family: monospace;
            white-space: pre-wrap;
            color: #10b981;
        }

        /* Alert Boxes */
        .alert {
            padding: 1.5rem;
            border-radius: 10px;
            margin: 1.5rem 0;
        }

        .alert-info {
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
        }

        .alert-warning {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        /* Navigation */
        .lesson-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 4rem 0 2rem;
            padding: 2rem;
            background: rgba(30, 41, 59, 0.3);
            border-radius: 20px;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .nav-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem 2rem;
            background: rgba(99, 102, 241, 0.1);
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 50px;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: rgba(99, 102, 241, 0.2);
            transform: translateY(-2px);
        }

        .nav-btn.primary {
            background: var(--gradient);
            border: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .lesson-header h1 {
                font-size: 2.5rem;
            }
            
            .components-grid {
                grid-template-columns: 1fr;
            }
            
            .agent-diagram {
                flex-direction: column;
            }
            
            .diagram-arrow {
                transform: rotate(90deg);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <nav>
            <a href="../../index.html" class="logo">
                <span>🧠</span> AI Learning Hub
            </a>
            <ul class="nav-links">
                <li><a href="../../lezioni.html">← Tutte le Lezioni</a></li>
                <li><a href="../../index.html" class="back-home">🏠 Home</a></li>
            </ul>
        </nav>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Lesson Header -->
        <div class="lesson-header">
            <div class="lesson-meta">
                📄 Fonte: OpenAI - A Practical Guide to Building Agents
            </div>
            <h1>Fondamenti del Design degli Agenti</h1>
            <p class="lesson-subtitle">
                Scopri i tre componenti fondamentali per costruire agenti AI efficaci e impara a configurarli correttamente
            </p>
        </div>

        <!-- Progress -->
        <div class="progress-container">
            <div class="progress-header">
                <span>Lezione 2 di 6</span>
                <span>33% completato</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill"></div>
            </div>
        </div>

        <!-- Section 1: I Tre Pilastri -->
        <div class="content-section">
            <h2 class="section-title">
                <div class="section-icon">🏛️</div>
                I Tre Pilastri di un Agente
            </h2>
            
            <p style="font-size: 1.1rem; margin-bottom: 2rem; color: #cbd5e1;">
                Ogni agente AI è costruito su tre componenti fondamentali che lavorano in sinergia. 
                Comprenderli è essenziale per progettare agenti efficaci.
            </p>

            <div class="diagram-container">
                <h3 style="margin-bottom: 2rem;">Architettura di un Agente AI</h3>
                <div class="agent-diagram">
                    <div class="diagram-node" onclick="highlightComponent('model')">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">🧠</div>
                        <strong>Model</strong>
                        <p style="font-size: 0.9rem; color: #94a3b8; margin-top: 0.5rem;">
                            Il cervello dell'agente
                        </p>
                    </div>
                    <div class="diagram-arrow">→</div>
                    <div class="diagram-node" onclick="highlightComponent('tools')">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">🔧</div>
                        <strong>Tools</strong>
                        <p style="font-size: 0.9rem; color: #94a3b8; margin-top: 0.5rem;">
                            Le mani dell'agente
                        </p>
                    </div>
                    <div class="diagram-arrow">→</div>
                    <div class="diagram-node" onclick="highlightComponent('instructions')">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">📋</div>
                        <strong>Instructions</strong>
                        <p style="font-size: 0.9rem; color: #94a3b8; margin-top: 0.5rem;">
                            La guida dell'agente
                        </p>
                    </div>
                </div>
                <p style="margin-top: 2rem; color: #94a3b8;">
                    <em>Clicca su ogni componente per approfondire</em>
                </p>
            </div>

            <div class="components-grid">
                <div class="component-card" id="model-card">
                    <div class="component-icon">🧠</div>
                    <h3>Model - Il Motore di Ragionamento</h3>
                    <p>
                        Il Large Language Model che alimenta le capacità di ragionamento e decisione dell'agente. 
                        Sceglie quali azioni intraprendere e come rispondere.
                    </p>
                    <ul style="margin-top: 1rem; padding-left: 1.5rem; color: #cbd5e1;">
                        <li>Processa il linguaggio naturale</li>
                        <li>Prende decisioni autonome</li>
                        <li>Genera risposte contestuali</li>
                    </ul>
                </div>

                <div class="component-card" id="tools-card">
                    <div class="component-icon">🔧</div>
                    <h3>Tools - Le Capacità di Azione</h3>
                    <p>
                        Funzioni esterne o API che l'agente può utilizzare per interagire con il mondo, 
                        raccogliere informazioni e compiere azioni.
                    </p>
                    <ul style="margin-top: 1rem; padding-left: 1.5rem; color: #cbd5e1;">
                        <li>API per recuperare dati</li>
                        <li>Funzioni per modificare sistemi</li>
                        <li>Integrazioni con servizi esterni</li>
                    </ul>
                </div>

                <div class="component-card" id="instructions-card">
                    <div class="component-icon">📋</div>
                    <h3>Instructions - Le Linee Guida</h3>
                    <p>
                        Direttive esplicite che definiscono come l'agente deve comportarsi, quali sono i suoi 
                        obiettivi e i suoi limiti operativi.
                    </p>
                    <ul style="margin-top: 1rem; padding-left: 1.5rem; color: #cbd5e1;">
                        <li>Definiscono la personalità</li>
                        <li>Stabiliscono i guardrail</li>
                        <li>Guidano il processo decisionale</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Section 2: Selezione del Modello -->
        <div class="content-section">
            <h2 class="section-title">
                <div class="section-icon">🎯</div>
                Scegliere il Modello Giusto
            </h2>

            <p style="font-size: 1.1rem; margin-bottom: 2rem; color: #cbd5e1;">
                Non tutti i task richiedono il modello più potente. La chiave è bilanciare capacità, velocità e costi.
            </p>

            <div style="overflow-x: auto;">
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Modello</th>
                            <th>Capacità</th>
                            <th>Velocità</th>
                            <th>Costo</th>
                            <th>Caso d'uso ideale</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>GPT-4</strong></td>
                            <td>⭐⭐⭐⭐⭐</td>
                            <td>⭐⭐</td>
                            <td>💰💰💰💰</td>
                            <td>Ragionamento complesso, decisioni critiche</td>
                        </tr>
                        <tr>
                            <td><strong>GPT-3.5</strong></td>
                            <td>⭐⭐⭐⭐</td>
                            <td>⭐⭐⭐⭐</td>
                            <td>💰💰</td>
                            <td>Task generali, chatbot, analisi moderate</td>
                        </tr>
                        <tr>
                            <td><strong>Models Fine-tuned</strong></td>
                            <td>⭐⭐⭐</td>
                            <td>⭐⭐⭐⭐⭐</td>
                            <td>💰</td>
                            <td>Task specifici, classificazione, routing</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="alert alert-info" style="margin-top: 2rem;">
                <h4 style="margin-bottom: 1rem; color: var(--primary);">
                    💡 Best Practice: Approccio Incrementale
                </h4>
                <ol style="padding-left: 1.5rem; color: #cbd5e1;">
                    <li style="margin-bottom: 0.5rem;">
                        <strong>Inizia con il modello più capace</strong> per stabilire una baseline di performance
                    </li>
                    <li style="margin-bottom: 0.5rem;">
                        <strong>Identifica i task semplici</strong> che possono essere gestiti da modelli più piccoli
                    </li>
                    <li>
                        <strong>Ottimizza progressivamente</strong> sostituendo con modelli più economici dove possibile
                    </li>
                </ol>
            </div>
        </div>

        <!-- Section 3: Esempio Pratico -->
        <div class="content-section">
            <h2 class="section-title">
                <div class="section-icon">💻</div>
                Costruiamo il Nostro Primo Agente
            </h2>

            <p style="margin-bottom: 2rem;">
                Mettiamo in pratica i concetti creando un semplice agente per il meteo. 
                Ti guiderò passo passo dall'installazione al test completo.
            </p>

            <!-- Step 1: Setup -->
            <div class="alert alert-success" style="margin-bottom: 2rem;">
                <h3 style="color: var(--success); margin-bottom: 1.5rem;">
                    📦 Step 1: Setup dell'Ambiente
                </h3>
                
                <div class="code-example">
                    <div class="code-header">
                        <span class="code-lang">Bash - Installazione</span>
                        <button class="copy-btn" onclick="copyCode(this)">📋 Copia</button>
                    </div>
                    <pre><code># 1. Crea una nuova cartella per il progetto
mkdir primo-agente-ai
cd primo-agente-ai

# 2. Crea un ambiente virtuale Python
python -m venv venv

# 3. Attiva l'ambiente virtuale
# Su Windows:
venv\Scripts\activate
# Su Mac/Linux:
source venv/bin/activate

# 4. Installa le dipendenze necessarie
pip install openai python-dotenv</code></pre>
                </div>
            </div>

            <!-- Step 2: API Key -->
            <div class="alert alert-info" style="margin-bottom: 2rem;">
                <h3 style="color: var(--primary); margin-bottom: 1.5rem;">
                    🔑 Step 2: Configura la tua API Key
                </h3>
                
                <p style="margin-bottom: 1rem;">
                    1. Vai su <a href="https://platform.openai.com/api-keys" target="_blank" style="color: var(--primary);">platform.openai.com/api-keys</a><br>
                    2. Crea una nuova API key<br>
                    3. Crea un file <code>.env</code> nella cartella del progetto:
                </p>

                <div class="code-example">
                    <div class="code-header">
                        <span class="code-lang">.env</span>
                        <button class="copy-btn" onclick="copyCode(this)">📋 Copia</button>
                    </div>
                    <pre><code># Inserisci la tua API key qui
OPENAI_API_KEY=sk-proj-xxxxxxxxxxxxxxxxxxxx</code></pre>
                </div>

                <p style="margin-top: 1rem; padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: 10px; border: 1px solid rgba(239, 68, 68, 0.3);">
                    ⚠️ <strong>Importante:</strong> Non condividere mai la tua API key e aggiungi <code>.env</code> al <code>.gitignore</code>
                </p>
                
                <p style="margin-top: 1rem; padding: 1rem; background: rgba(99, 102, 241, 0.1); border-radius: 10px; border: 1px solid rgba(99, 102, 241, 0.3);">
                    💡 <strong>Nota:</strong> Useremo prima dati simulati per testare l'agente, poi ti mostrerò come integrare una vera API meteo
                </p>
            </div>

            <!-- Step 3: Complete Code -->
            <div class="alert alert-warning" style="margin-bottom: 2rem;">
                <h3 style="color: var(--warning); margin-bottom: 1.5rem;">
                    🚀 Step 3: Codice Completo dell'Agente
                </h3>
                
                <p style="margin-bottom: 1.5rem;">
                    Crea un file <code>weather_agent.py</code> con questo codice:
                </p>

                <div class="code-example">
                    <div class="code-header">
                        <span class="code-lang">Python - weather_agent.py</span>
                        <button class="copy-btn" onclick="copyCode(this)">📋 Copia</button>
                    </div>
                    <pre><code>import os
from dotenv import load_dotenv
from openai import OpenAI
import json

# Carica le variabili d'ambiente
load_dotenv()

# Inizializza il client OpenAI
client = OpenAI(api_key=os.getenv("OPENAI_API_KEY"))

# Simuliamo un database di dati meteo
WEATHER_DATA = {
    "milano": {"temp": 22, "condition": "soleggiato", "humidity": 65},
    "roma": {"temp": 25, "condition": "nuvoloso", "humidity": 70},
    "napoli": {"temp": 20, "condition": "pioggia leggera", "humidity": 80},
    "torino": {"temp": 19, "condition": "nebbia", "humidity": 85},
    "firenze": {"temp": 23, "condition": "parzialmente nuvoloso", "humidity": 60}
}

def get_weather(city: str) -> str:
    """
    Ottiene le informazioni meteo per una città specifica.
    
    Args:
        city: Nome della città
        
    Returns:
        Stringa con le informazioni meteo o messaggio di errore
    """
    city_lower = city.lower()
    
    if city_lower in WEATHER_DATA:
        data = WEATHER_DATA[city_lower]
        return json.dumps({
            "città": city,
            "temperatura": f"{data['temp']}°C",
            "condizioni": data["condition"],
            "umidità": f"{data['humidity']}%"
        }, ensure_ascii=False)
    else:
        return json.dumps({
            "errore": f"Dati non disponibili per {city}",
            "città_disponibili": list(WEATHER_DATA.keys())
        }, ensure_ascii=False)

# Definizione delle funzioni disponibili per l'assistente
functions = [
    {
        "name": "get_weather",
        "description": "Ottiene le informazioni meteo attuali per una città italiana",
        "parameters": {
            "type": "object",
            "properties": {
                "city": {
                    "type": "string",
                    "description": "Il nome della città, es. Milano, Roma"
                }
            },
            "required": ["city"]
        }
    }
]

def run_weather_agent(user_message: str):
    """
    Esegue l'agente meteo con il messaggio dell'utente.
    """
    print(f"\n👤 Utente: {user_message}")
    
    # Primo messaggio all'assistente con le istruzioni
    messages = [
        {
            "role": "system",
            "content": """Sei un assistente meteorologico italiano amichevole e preciso.
            
Quando l'utente chiede informazioni sul meteo:
1. Identifica la città di interesse
2. Usa la funzione get_weather per ottenere i dati
3. Presenta le informazioni in modo chiaro e conversazionale
4. Suggerisci cosa indossare o attività appropriate per il meteo
5. Se la città non è disponibile, suggerisci alternative tra quelle disponibili

Rispondi sempre in italiano e con un tono amichevole."""
        },
        {
            "role": "user",
            "content": user_message
        }
    ]
    
    # Prima chiamata all'API
    response = client.chat.completions.create(
        model="gpt-3.5-turbo",
        messages=messages,
        functions=functions,
        function_call="auto"
    )
    
    message = response.choices[0].message
    
    # Se il modello vuole chiamare una funzione
    if message.function_call:
        function_name = message.function_call.name
        function_args = json.loads(message.function_call.arguments)
        
        print(f"\n🔧 Chiamata funzione: {function_name}({function_args})")
        
        # Esegui la funzione
        if function_name == "get_weather":
            function_result = get_weather(function_args["city"])
            
            # Aggiungi il risultato alla conversazione
            messages.append({
                "role": "function",
                "name": function_name,
                "content": function_result
            })
            
            # Seconda chiamata per ottenere la risposta finale
            final_response = client.chat.completions.create(
                model="gpt-3.5-turbo",
                messages=messages
            )
            
            final_message = final_response.choices[0].message.content
            print(f"\n🤖 Assistente: {final_message}")
            return final_message
    else:
        # Risposta diretta senza chiamata di funzione
        print(f"\n🤖 Assistente: {message.content}")
        return message.content

# Funzione principale per testare l'agente
def main():
    print("🌤️  Benvenuto nell'Assistente Meteo AI!")
    print("=" * 50)
    
    # Esempi di test
    test_queries = [
        "Com'è il tempo a Milano oggi?",
        "Che tempo fa a Roma?",
        "Mi serve l'ombrello a Napoli?",
        "Dimmi il meteo di Venezia",  # Città non disponibile
        "Fa freddo a Torino?"
    ]
    
    print("\n📝 Eseguiamo alcuni test...")
    
    for query in test_queries[:2]:  # Testa le prime 2 query
        run_weather_agent(query)
        print("\n" + "-" * 50)
    
    # Modalità interattiva
    print("\n💬 Ora puoi fare le tue domande! (digita 'exit' per uscire)")
    
    while True:
        user_input = input("\n👤 Tu: ")
        if user_input.lower() in ['exit', 'quit', 'esci']:
            print("👋 Arrivederci!")
            break
        
        run_weather_agent(user_input)

if __name__ == "__main__":
    main()</code></pre>
                </div>
            </div>

            <!-- Step 4: Run -->
            <div class="alert alert-success" style="margin-bottom: 2rem;">
                <h3 style="color: var(--success); margin-bottom: 1.5rem;">
                    ▶️ Step 4: Esegui e Testa l'Agente
                </h3>
                
                <div class="code-example">
                    <div class="code-header">
                        <span class="code-lang">Bash - Esecuzione</span>
                        <button class="copy-btn" onclick="copyCode(this)">📋 Copia</button>
                    </div>
                    <pre><code># Assicurati di essere nella cartella del progetto con venv attivato
python weather_agent.py</code></pre>
                </div>

                <h4 style="margin-top: 1.5rem; margin-bottom: 1rem;">Output di Esempio:</h4>
                <div class="code-example" style="background: #0a0a0a;">
                    <pre style="color: #10b981;"><code>🌤️  Benvenuto nell'Assistente Meteo AI!
==================================================

📝 Eseguiamo alcuni test...

👤 Utente: Com'è il tempo a Milano oggi?

🔧 Chiamata funzione: get_weather({'city': 'Milano'})

🤖 Assistente: A Milano oggi c'è un bel sole! ☀️ 
La temperatura è di 22°C con cielo soleggiato e un'umidità del 65%. 

È una giornata perfetta per una passeggiata! Ti consiglio di indossare 
abiti leggeri e comodi. Non dimenticare gli occhiali da sole e magari 
una bottiglietta d'acqua per rimanere idratato.

--------------------------------------------------

💬 Ora puoi fare le tue domande! (digita 'exit' per uscire)

👤 Tu: _</code></pre>
                </div>
            </div>

            <!-- Troubleshooting -->
            <div class="alert alert-warning">
                <h3 style="color: var(--warning); margin-bottom: 1.5rem;">
                    🔧 Troubleshooting Comune
                </h3>
                
                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: #f8fafc; margin-bottom: 0.5rem;">Errore: "Invalid API Key"</h4>
                    <p style="color: #cbd5e1;">
                        ✓ Verifica che il file <code>.env</code> sia nella stessa cartella del tuo script<br>
                        ✓ Controlla che la API key sia corretta e attiva<br>
                        ✓ Assicurati di aver caricato l'ambiente con <code>load_dotenv()</code>
                    </p>
                </div>

                <div style="margin-bottom: 1.5rem;">
                    <h4 style="color: #f8fafc; margin-bottom: 0.5rem;">Errore: "Module not found"</h4>
                    <p style="color: #cbd5e1;">
                        ✓ Verifica di aver attivato l'ambiente virtuale<br>
                        ✓ Reinstalla le dipendenze: <code>pip install openai python-dotenv</code>
                    </p>
                </div>

                <div>
                    <h4 style="color: #f8fafc; margin-bottom: 0.5rem;">L'agente non chiama la funzione</h4>
                    <p style="color: #cbd5e1;">
                        ✓ Assicurati che la domanda sia chiara e riguardi il meteo<br>
                        ✓ Verifica che il parametro <code>functions</code> sia passato correttamente<br>
                        ✓ Prova con domande più esplicite come "Che tempo fa a Milano?"
                    </p>
                </div>
            </div>

            <div style="margin-top: 2rem; padding: 1.5rem; background: rgba(245, 158, 11, 0.1); border-radius: 15px; border: 1px solid rgba(245, 158, 11, 0.3);">
                <h4 style="color: var(--warning); margin-bottom: 1rem;">
                    ⚡ Riepilogo: Cosa è Reale vs Simulato
                </h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; color: #cbd5e1;">
                    <div>
                        <h5 style="color: var(--success); margin-bottom: 0.5rem;">✅ REALE nell'esempio:</h5>
                        <ul style="padding-left: 1.5rem;">
                            <li>L'AI di OpenAI (GPT-3.5)</li>
                            <li>Il ragionamento dell'agente</li>
                            <li>La decisione di chiamare funzioni</li>
                            <li>La generazione del linguaggio</li>
                            <li>La personalizzazione delle risposte</li>
                        </ul>
                    </div>
                    <div>
                        <h5 style="color: var(--warning); margin-bottom: 0.5rem;">📊 SIMULATO nell'esempio base:</h5>
                        <ul style="padding-left: 1.5rem;">
                            <li>I dati meteo (per semplicità)</li>
                            <li>Il "database" delle città</li>
                            <li>Le temperature/condizioni</li>
                        </ul>
                        <p style="margin-top: 0.5rem; font-size: 0.9rem;">
                            (Ma puoi renderli reali con la nostra guida!)
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Lab Section -->
        <div class="lab-section">
            <div class="lab-header">
                <h2 class="section-title" style="margin: 0;">
                    <div class="section-icon">🧪</div>
                    Lab Interattivo: Progetta il Tuo Agente
                </h2>
                <span class="lab-badge">Hands-on</span>
            </div>

            <p style="margin-bottom: 2rem;">
                Usa questo playground per sperimentare con diversi tipi di istruzioni e vedere come influenzano 
                il comportamento dell'agente.
            </p>

            <div style="background: rgba(15, 23, 42, 0.5); border-radius: 15px; padding: 2rem;">
                <h3 style="margin-bottom: 1.5rem;">Configuratore di Agente</h3>
                
                <div class="lab-controls">
                    <select class="lab-input" id="agent-type">
                        <option value="customer">Customer Service</option>
                        <option value="teacher">Insegnante</option>
                        <option value="analyst">Analista Dati</option>
                        <option value="creative">Scrittore Creativo</option>
                    </select>
                    
                    <select class="lab-input" id="personality">
                        <option value="professional">Professionale</option>
                        <option value="friendly">Amichevole</option>
                        <option value="concise">Conciso</option>
                        <option value="detailed">Dettagliato</option>
                    </select>
                    
                    <button class="lab-button" onclick="generateAgent()">
                        Genera Configurazione
                    </button>
                </div>

                <div class="lab-output" id="agent-output">
                    <em style="color: #64748b;">
                        Seleziona un tipo di agente e una personalità, poi clicca "Genera Configurazione"
                    </em>
                </div>
            </div>

            <div class="alert alert-success" style="margin-top: 2rem;">
                <h4 style="color: var(--success); margin-bottom: 1rem;">
                    📝 Esercizio Pratico
                </h4>
                <p style="color: #cbd5e1;">
                    Dopo aver sperimentato con il configuratore:
                </p>
                <ol style="margin-top: 1rem; padding-left: 1.5rem; color: #cbd5e1;">
                    <li style="margin-bottom: 0.5rem;">
                        Scegli un caso d'uso specifico per il tuo lavoro o studio
                    </li>
                    <li style="margin-bottom: 0.5rem;">
                        Definisci quali tools sarebbero necessari
                    </li>
                    <li>
                        Scrivi le istruzioni complete per guidare l'agente
                    </li>
                </ol>
            </div>
        </div>

        <!-- Key Takeaways -->
        <div class="content-section">
            <h2 class="section-title">
                <div class="section-icon">🎓</div>
                Punti Chiave da Ricordare
            </h2>

            <div style="display: grid; gap: 1rem;">
                <div style="background: rgba(99, 102, 241, 0.1); padding: 1.5rem; border-radius: 15px; border: 1px solid rgba(99, 102, 241, 0.3);">
                    <h4 style="color: var(--primary); margin-bottom: 0.5rem;">
                        1️⃣ I tre componenti sono interdipendenti
                    </h4>
                    <p style="color: #cbd5e1;">
                        Model, Tools e Instructions devono essere progettati per lavorare in armonia. 
                        Un modello potente con istruzioni scadenti produrrà risultati deludenti.
                    </p>
                </div>

                <div style="background: rgba(236, 72, 153, 0.1); padding: 1.5rem; border-radius: 15px; border: 1px solid rgba(236, 72, 153, 0.3);">
                    <h4 style="color: var(--secondary); margin-bottom: 0.5rem;">
                        2️⃣ Inizia semplice, poi evolvi
                    </h4>
                    <p style="color: #cbd5e1;">
                        Non cercare di costruire l'agente perfetto al primo tentativo. 
                        Parti con funzionalità base e aggiungi complessità iterativamente.
                    </p>
                </div>

                <div style="background: rgba(6, 182, 212, 0.1); padding: 1.5rem; border-radius: 15px; border: 1px solid rgba(6, 182, 212, 0.3);">
                    <h4 style="color: var(--accent); margin-bottom: 0.5rem;">
                        3️⃣ Le istruzioni sono cruciali
                    </h4>
                    <p style="color: #cbd5e1;">
                        Istruzioni chiare e ben strutturate sono spesso la differenza tra un agente 
                        che funziona e uno che eccelle.
                    </p>
                </div>
            </div>
        </div>

        <!-- Next Steps -->
        <div class="content-section" style="background: rgba(16, 185, 129, 0.05); border: 1px solid rgba(16, 185, 129, 0.2);">
            <h2 class="section-title">
                <div class="section-icon">🚀</div>
                Prossimi Passi
            </h2>
            
            <p style="margin-bottom: 2rem; color: #cbd5e1;">
                Ora che hai un agente AI funzionante con dati simulati, ecco cosa puoi fare:
            </p>

            <div style="display: grid; gap: 1.5rem;">
                <div style="background: rgba(30, 41, 59, 0.5); padding: 1.5rem; border-radius: 15px;">
                    <h4 style="color: #f8fafc; margin-bottom: 0.5rem;">
                        📚 Per Continuare ad Imparare:
                    </h4>
                    <ul style="padding-left: 1.5rem; color: #cbd5e1;">
                        <li>Sperimenta con diverse personalità dell'agente</li>
                        <li>Aggiungi più funzioni (previsioni, consigli vestiti)</li>
                        <li>Prova a usare GPT-4 invece di GPT-3.5</li>
                        <li>Crea agenti per altri scopi (news, ricette, etc.)</li>
                    </ul>
                </div>

                <div style="background: rgba(30, 41, 59, 0.5); padding: 1.5rem; border-radius: 15px;">
                    <h4 style="color: #f8fafc; margin-bottom: 0.5rem;">
                        🌍 Per Dati Meteo Reali:
                    </h4>
                    <p style="color: #cbd5e1; margin-bottom: 1rem;">
                        Quando sei pronto per passare ai dati reali:
                    </p>
                    <a href="../../guide/agenti-api-reali.html" 
                       style="display: inline-block; padding: 0.8rem 2rem; background: var(--gradient); 
                              color: white; text-decoration: none; border-radius: 50px; 
                              font-weight: 600; transition: transform 0.3s ease;">
                        Vai alla Guida API Meteo Reali →
                    </a>
                    <p style="color: #94a3b8; margin-top: 1rem; font-size: 0.9rem;">
                        Include: confronto API, tutorial passo-passo, gestione errori, caching e altro!
                    </p>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="lesson-nav">
            <a href="lezione-1.html" class="nav-btn">
                ← Lezione 1
            </a>
            <div style="text-align: center;">
                <p style="color: #94a3b8; margin-bottom: 0.5rem;">Prossima lezione:</p>
                <strong>Tools e Instructions Avanzate</strong>
            </div>
            <a href="lezione-3.html" class="nav-btn primary">
                Continua →
            </a>
        </div>
    </main>

    <script>
        // Copy code function
        function copyCode(button) {
            const codeBlock = button.parentElement.nextElementSibling.querySelector('code');
            const text = codeBlock.innerText;
            
            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.innerText;
                button.innerText = '✅ Copiato!';
                button.style.background = 'rgba(16, 185, 129, 0.2)';
                button.style.borderColor = 'rgba(16, 185, 129, 0.5)';
                button.style.color = '#10b981';
                
                setTimeout(() => {
                    button.innerText = originalText;
                    button.style.background = '';
                    button.style.borderColor = '';
                    button.style.color = '';
                }, 2000);
            });
        }

        // Highlight component
        function highlightComponent(component) {
            // Reset all cards
            document.querySelectorAll('.component-card').forEach(card => {
                card.style.transform = '';
                card.style.boxShadow = '';
                card.style.borderColor = '';
            });
            
            // Highlight selected card
            const card = document.getElementById(component + '-card');
            if (card) {
                card.style.transform = 'scale(1.05)';
                card.style.boxShadow = '0 20px 40px rgba(99, 102, 241, 0.4)';
                card.style.borderColor = 'rgba(99, 102, 241, 0.5)';
                
                // Smooth scroll to card
                card.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        // Lab: Generate Agent Configuration
        function generateAgent() {
            const type = document.getElementById('agent-type').value;
            const personality = document.getElementById('personality').value;
            const output = document.getElementById('agent-output');
            
            const configurations = {
                customer: {
                    professional: `Agent(
    name="Assistente Customer Service Professionale",
    instructions="""
    Sei un assistente customer service altamente professionale.
    
    Linee guida:
    - Usa sempre un tono formale e cortese
    - Risolvi i problemi in modo sistematico
    - Documenta ogni interazione accuratamente
    - Escalation automatica per casi complessi
    """,
    tools=[
        check_order_status,
        process_refund,
        escalate_to_human,
        send_email_confirmation
    ]
)`,
                    friendly: `Agent(
    name="Assistente Customer Service Amichevole",
    instructions="""
    Sei un assistente customer service cordiale ed empatico.
    
    Linee guida:
    - Usa un tono caldo e accogliente
    - Mostra comprensione per le frustrazioni del cliente
    - Usa emoji con moderazione per alleggerire il tono 😊
    - Personalizza le risposte quando possibile
    """,
    tools=[
        check_order_status,
        process_refund,
        suggest_alternatives,
        collect_feedback
    ]
)`
                },
                teacher: {
                    professional: `Agent(
    name="Tutor AI Professionale",
    instructions="""
    Sei un insegnante esperto e professionale.
    
    Approccio didattico:
    - Struttura le lezioni in modo chiaro e logico
    - Usa terminologia accademica appropriata
    - Fornisci riferimenti e fonti autorevoli
    - Valuta oggettivamente i progressi
    """,
    tools=[
        generate_quiz,
        check_understanding,
        provide_resources,
        track_progress
    ]
)`,
                    detailed: `Agent(
    name="Tutor AI Dettagliato",
    instructions="""
    Sei un insegnante che ama spiegazioni approfondite.
    
    Metodologia:
    - Spiega ogni concetto da multiple prospettive
    - Fornisci esempi dettagliati per ogni punto
    - Anticipa e rispondi a domande comuni
    - Crea mappe concettuali complete
    """,
    tools=[
        explain_concept,
        generate_examples,
        create_mindmap,
        deep_dive_topic
    ]
)`
                },
                analyst: {
                    concise: `Agent(
    name="Analista Dati Conciso",
    instructions="""
    Sei un analista che fornisce insights diretti.
    
    Stile di comunicazione:
    - Vai dritto al punto
    - Usa bullet points per chiarezza
    - Evidenzia solo i dati più rilevanti
    - Conclusioni chiare e azionabili
    """,
    tools=[
        analyze_data,
        generate_report,
        create_visualization,
        export_results
    ]
)`
                },
                creative: {
                    friendly: `Agent(
    name="Scrittore Creativo Amichevole",
    instructions="""
    Sei uno scrittore creativo entusiasta e incoraggiante.
    
    Approccio creativo:
    - Incoraggia la sperimentazione
    - Offri feedback positivo e costruttivo
    - Suggerisci tecniche creative divertenti
    - Celebra ogni progresso!
    """,
    tools=[
        generate_ideas,
        improve_writing,
        suggest_prompts,
        analyze_style
    ]
)`
                }
            };
            
            // Get configuration or show default
            const config = configurations[type]?.[personality] || 
                `# Configurazione personalizzata per: ${type} - ${personality}\n\n` +
                `Agent(\n    name="Agente Personalizzato",\n    instructions="Da definire...",\n    tools=[]\n)`;
            
            output.textContent = config;
            
            // Add animation
            output.style.opacity = '0';
            setTimeout(() => {
                output.style.transition = 'opacity 0.5s ease';
                output.style.opacity = '1';
            }, 100);
        }

        // Add animation on scroll
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = '0';
                    entry.target.style.transform = 'translateY(20px)';
                    
                    setTimeout(() => {
                        entry.target.style.transition = 'all 0.6s ease-out';
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }, 100);
                    
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);

        // Observe all content sections
        document.querySelectorAll('.content-section').forEach(section => {
            observer.observe(section);
        });
    </script>
</body>
</html>
